# Ofelia configuration for TYPO3 scheduler jobs
# This runs the TYPO3 scheduler every minute
# Uses ghcr.io/netresearch/ofelia for TYPO3-optimized cron handling

services:
  web:
    labels:
      # Run TYPO3 scheduler every minute for all versions
      ofelia.job-exec.typo3-scheduler-v11.schedule: "@every 1m"
      ofelia.job-exec.typo3-scheduler-v11.command: "bash -c 'cd /var/www/html/v11 && [ -f vendor/bin/typo3 ] && vendor/bin/typo3 scheduler:run || true'"
      ofelia.job-exec.typo3-scheduler-v11.no-overlap: "true"

      ofelia.job-exec.typo3-scheduler-v12.schedule: "@every 1m"
      ofelia.job-exec.typo3-scheduler-v12.command: "bash -c 'cd /var/www/html/v12 && [ -f vendor/bin/typo3 ] && vendor/bin/typo3 scheduler:run || true'"
      ofelia.job-exec.typo3-scheduler-v12.no-overlap: "true"

      ofelia.job-exec.typo3-scheduler-v13.schedule: "@every 1m"
      ofelia.job-exec.typo3-scheduler-v13.command: "bash -c 'cd /var/www/html/v13 && [ -f vendor/bin/typo3 ] && vendor/bin/typo3 scheduler:run || true'"
      ofelia.job-exec.typo3-scheduler-v13.no-overlap: "true"

      # Optional: Clear cache every hour
      ofelia.job-exec.cache-warmup-v13.schedule: "@every 1h"
      ofelia.job-exec.cache-warmup-v13.command: "bash -c 'cd /var/www/html/v13 && vendor/bin/typo3 cache:warmup || true'"
      ofelia.job-exec.cache-warmup-v13.no-overlap: "true"
